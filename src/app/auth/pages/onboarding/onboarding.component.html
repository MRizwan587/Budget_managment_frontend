<p>onboarding works!</p>
<div class="onboarding-container">
  <mat-card class="onboarding-card">
    <mat-card-header>
      <mat-card-title>Two-Factor Authentication Setup</mat-card-title>
      <mat-card-subtitle>Secure your expense tracker account.</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>

      <!-- --------------------------------- -->
      <!-- STATE 1: SELECTION (Choose Method) -->
      <!-- --------------------------------- -->
      <div *ngIf="currentState === 'selection'" class="selection-grid">
        <p>Please select your preferred method for two-factor authentication.</p>
        
        <!-- Authenticator App Option -->
        <button mat-flat-button color="primary" class="method-button" (click)="selectAuthenticatorApp()">
          <mat-icon>security</mat-icon>
          <span>Use Authenticator App (Recommended)</span>
        </button>

        <!-- Email Option -->
        <button mat-flat-button color="accent" class="method-button" (click)="selectEmail()">
          <mat-icon>email</mat-icon>
          <span>Authenticate with Email</span>
        </button>
      </div>


      <!-- --------------------------------- -->
      <!-- STATE 2: SETUP (QR Code Display - Only for 'app') -->
      <!-- --------------------------------- -->
      <div *ngIf="currentState === 'setup' && selectedMethod === 'AuthenticatorApp'">
        <mat-spinner *ngIf="isLoading" diameter="40"></mat-spinner>
        
        <div *ngIf="qrCodeUrl">
          <p class="mt-4 text-center">Scan the QR code below with your favorite authenticator app (e.g., Google Authenticator, Authy).</p>
          
          <div class="qr-code-wrapper">
            <!-- QR Code from API (using the mock URL) -->
            <img [src]="qrCodeUrl" alt="2FA QR Code" class="qr-code">
          </div>
          <p class="text-center mt-4">Once scanned, enter the 6-digit code below to complete setup.</p>
        </div>
      </div>


      <!-- --------------------------------- -->
      <!-- STATE 3: VERIFICATION (OTP Input) -->
      <!-- --------------------------------- -->
      <div *ngIf="currentState === 'setup'">
        <p class="verification-prompt">
          <span *ngIf="selectedMethod === 'AuthenticatorApp'">Enter the 6-digit code generated by your authenticator app.</span>
          <span *ngIf="selectedMethod === 'Email'">Enter the 6-digit code sent to your registered email address.</span>
        </p>

        <form (ngSubmit)="verifyCode()" class="verification-form">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>6-Digit Code</mat-label>
            <input 
              matInput 
              [(ngModel)]="otpCode" 
              name="otpCode"
              type="text"
              minlength="6"
              maxlength="6"
              required
              inputmode="numeric"
              autocomplete="one-time-code">
          </mat-form-field>

          <div *ngIf="errorMessage" class="error-message">
            <mat-icon color="warn">error</mat-icon> {{ errorMessage }}
          </div>

          <button 
            mat-raised-button 
            color="primary" 
            type="submit" 
            [disabled]="otpCode.length !== 6 || isLoading"
            class="full-width verify-button">
            <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
            {{ isLoading ? 'Verifying...' : 'Verify & Continue' }}
          </button>
        </form>

        <button 
            mat-button 
            color="accent" 
            class="mt-3 full-width"
            *ngIf="selectedMethod === 'Email' && !isLoading"
            (click)="setupEmail()">
            Resend Code
        </button>
      </div>
      
    </mat-card-content>
  </mat-card>
</div>

