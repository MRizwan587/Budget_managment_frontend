<mat-card class="bo main-container">
  <div class="transaction-header">
    <h2 class="title">Transactions</h2>

    <button
      mat-raised-button
      color="primary"
      class="create-btn"
      [routerLink]="['create-transactions']"
    >
      <mat-icon>add</mat-icon>
      Create Transaction
    </button>
  </div>

  <!-- FILTERS -->
  <div class="filters">
    <!-- Date Range Filter -->
    <mat-form-field appearance="outline">
      <mat-label>Date Range</mat-label>

      <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
        <input matStartDate formControlName="start" placeholder="Start date" />
        <input matEndDate formControlName="end" placeholder="End date" />
      </mat-date-range-input>

      <mat-datepicker-toggle
        matIconSuffix
        [for]="picker"
      ></mat-datepicker-toggle>
      <mat-date-range-picker #picker></mat-date-range-picker>
    </mat-form-field>

    <!-- Type Filter -->
    <mat-form-field appearance="outline">
      <mat-label>Type</mat-label>
      <mat-select [(ngModel)]="filters.type" (selectionChange)="applyFilters()">
        <mat-option value="">All</mat-option>
        <mat-option value="income">Income</mat-option>
        <mat-option value="expense">Expense</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Category Filter -->
    <mat-form-field appearance="outline">
      <mat-label>Category</mat-label>
      <mat-select
        [(ngModel)]="filters.category"
        (selectionChange)="applyFilters()"
      >
        <mat-option value="">All</mat-option>
        <mat-option *ngFor="let cat of categoryList" [value]="cat._id">
          {{ cat.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Min Amount -->
    <mat-form-field appearance="outline">
      <mat-label>Amount Min</mat-label>
      <input
        matInput
        type="number"
        [(ngModel)]="filters.minAmount"
        (keyup)="applyFilters()"
      />
    </mat-form-field>

    <!-- Max Amount -->
    <mat-form-field appearance="outline">
      <mat-label>Amount Max</mat-label>
      <input
        matInput
        type="number"
        [(ngModel)]="filters.maxAmount"
        (keyup)="applyFilters()"
      />
    </mat-form-field>
  </div>

  <!-- TABLE -->
  <div class="table-wrapper">
    <mat-table [dataSource]="dataSource" class="mat-elevation-z2">
      <!-- Date -->
      <ng-container matColumnDef="date">
        <mat-header-cell *matHeaderCellDef> Date </mat-header-cell>
        <mat-cell *matCellDef="let element">
          {{ element.createdAt | date }}
        </mat-cell>
      </ng-container>

      <!-- Category -->
      <ng-container matColumnDef="category">
        <mat-header-cell *matHeaderCellDef> Category </mat-header-cell>
        <mat-cell *matCellDef="let element">
          <span class="category-pill">{{ element.category.name }}</span>
        </mat-cell>
      </ng-container>

      <!-- Type -->
      <ng-container matColumnDef="type">
        <mat-header-cell *matHeaderCellDef> Type </mat-header-cell>
        <mat-cell *matCellDef="let element">
          <span
            class="type"
            [ngClass]="{
              income: element.type?.toLowerCase() === 'income',
              expense: element.type?.toLowerCase() === 'expense'
            }"
          >
            {{ element.type | titlecase }}
          </span>
        </mat-cell>
      </ng-container>

      <!-- Amount -->
      <ng-container matColumnDef="amount">
        <mat-header-cell *matHeaderCellDef> Amount </mat-header-cell>
        <mat-cell *matCellDef="let element">
          <strong class="amount">{{ element.amount }}</strong>
        </mat-cell>
      </ng-container>

      <!-- Description -->
      <ng-container matColumnDef="description">
        <mat-header-cell *matHeaderCellDef> Description </mat-header-cell>
        <mat-cell *matCellDef="let element">
          <span class="desc-text">{{ element.description }}</span>
        </mat-cell>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef> Actions </mat-header-cell>
        <mat-cell *matCellDef="let element">
          <button mat-icon-button color="primary">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn">
            <mat-icon>delete</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
    </mat-table>
  </div>

  <!-- PAGINATION -->
  <mat-paginator
    [length]="totalRecords"
    [pageSize]="pageSize"
    [pageIndex]="pageIndex"
    [pageSizeOptions]="[5, 10, 20, 50]"
    (page)="onPagination($event)"
  >
  </mat-paginator>
</mat-card>
